<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Contacts List</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

<!-- datatables css -->

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.7/css/jquery.dataTables.css">

</head>
<body>
    <div class="jumbotron"><h1> Contacts List </h1>
      <p>Users in the system</p>
    </div>

<div class="container">
    <div class="user-listing">
        <!-- <table class="table table-striped"> -->
        <table id="contacts_table" class="display" cellspacing="0" width="100%">

            <thead>
                    <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Age</th>
                    <th>Date of Birth</th>
                    <th>Location</th>
                    <th>Last Update</th>
                    <th>Action</th>
                    </tr>
            </thead>
            <tbody>
        {% for contact in contacts %}
                <tr>
                <td>{{contact.id}}</td>
                <td>{{contact.first_name}} {{contact.last_name}}</td>
                <td>{{contact.email_id}}</td>
                <td>{{contact.age}}</td>
                <td>{{contact.dob}}</td>
                <td>{{contact.location|linebreaks}}</td>
                <td>{{contact.last_dml_time}}</td>
                <td>
                <form action="/update_contact/" method="POST">
                    <button>
                    <input name="user_pk" type="text" value="{{contact.id}}" style="display:none"/> <!--keep this hidden and it works as a normal form -->
                    <input type="button" class="btn-default btn-link" value = "Edit" id="{{contact.id}}" data-contactid="{{contact.id}}"/>
                    </button>
                    </form>
                </td>
                </tr>
        {% endfor %}

            </tbody>
        </table>
    </div> <!-- user-listing -->


      <div class="button-group " >
            <label class="col-md-1 control-label"></label>
            <div class="col-md-2">
                    <button id = "add_users" type="submit" onclick="location.href='http://127.0.0.1:8000/modify/';" class="btn btn-info" >Add Users  <span class="glyphicon glyphicon-plus"></span></button>
            </div>

</div> <!-- container -->
</div><!-- bootstrap -->


<!-- update page hack  -->

<!-- <form style="display: hidden" action="http://127.0.0.1:8000/modify/" method="POST" id="form">
  <input type="hidden" id="var1" name="var1" value=""/>
</form>
 --><!--  -->

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

      <!-- datatables -->
<script src ="https://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>



<!-- datatables script -->

<script type="text/javascript">

    $(document).ready(function() {

// hiding the id and last_dml_time columns need to hide columns before staging data
//for datatables

    // $('#contacts_table tr > *:nth-child(1)').hide();
    // $('#contacts_table tr > *:nth-child(7)').hide();


//create edit button redirects before staging data for datatables
    $('.btn-default.btn-link').click(function(){
        var contact_id;
        contact_id = $(this).attr("data-contactid");
        console.log(contact_id);
        // $("#var1").val(contact_id);
        // val_1 = $("#var1").val();

        $.ajax({
            url:"/update_contact/",//the endpoint
            type: "POST",
            data:{user_id: contact_id},
            success:function(json){
                console.log('~ ajax Sent user_id to server ~')
            }//success
            ,error :function(xhr,errmsg,err) {
              alert("Oops! We have encountered an error in finding the contact . Please try again!");
              window.location.replace("http://127.0.0.1:8000/");
                   }
        });//ajax
});//sending user_pk TO SERVER


// hiding the show x entries, search entries  and other columns in datatable

    $('#contacts_table').dataTable({
                "pageLength" : 5
                ,"bPagniation" : false
                ,"bLengthChange": false
                ,"bFilter": false
                ,"bInfo": false
                ,"order" : [[6,"desc"]]

    });



});//close document



</script>

</body>
</html>
